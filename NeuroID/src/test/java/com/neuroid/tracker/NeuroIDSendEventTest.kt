package com.neuroid.tracker

import com.neuroid.tracker.service.NIDResponseCallBack
import com.neuroid.tracker.service.NIDApiService
import com.neuroid.tracker.service.NIDEventSender
import io.mockk.Runs
import io.mockk.every
import io.mockk.just
import io.mockk.mockk
import io.mockk.verify
import kotlinx.coroutines.runBlocking
import okhttp3.ResponseBody
import org.junit.Test
import retrofit2.Call
import retrofit2.Response

class NeuroIDSendEventTest {
    @Test
    fun `successful send request test`() = runBlocking {
        val apiService = mockk<NIDApiService>()
        val call = mockk<Call<ResponseBody>>()
        val retryClone = mockk<Call<ResponseBody>>()
        val response = mockk<Response<ResponseBody>>()
        every {response.isSuccessful} returns true
        every {response.code()} returns 200
        every {response.message()} returns "should not happen"
        every {retryClone.execute()} returns response
        every {call.clone()} returns retryClone
        every {apiService.sendEvents(any(), any())} returns call
        val callback = mockk<NIDResponseCallBack>()
        every { callback.onSuccess(any()) } just Runs
        every { callback.onFailure(any(), any(), any()) } just Runs
        val events = "{\"siteId\":\"doom_109\",\"userId\":\"1693537992533\",\"clientId\":\"31-1-1-1\",\"identityId\":\"1693537992533\",\"pageTag\":\"com.sample.neuroid.us.activities.NIDSomeFragmentsActivity\",\"pageId\":\"mobile\",\"tabId\":\"mobile\",\"responseId\":\"bf57ea3b5402\",\"url\":\"android://com.sample.neuroid.us.activities.NIDSomeFragmentsActivity\",\"jsVersion\":\"5.0.0\",\"sdkVersion\":\"5.android-3.0.1\",\"environment\":\"LIVE\",\"jsonEvents\":[{\"type\":\"TOUCH_START\",\"tg\":{\"tgs\":\"editText_normal_field\",\"sender\":\"TextInputEditText\",\"etn\":\"TextInputEditText\"},\"attrs\":[{\"rawAction\":0},{},{\"pointerCount\":1,\"pointers\":{\"0\":{\"mPropId\":0,\"mPropToolType\":1}},\"yValues\":{\"y\":372,\"yP\":1,\"yR\":372,\"yCalc\":372},\"xValues\":{\"x\":180,\"xP\":1,\"xR\":180,\"xCalc\":180},\"pressure\":0.13385826,\"hSize\":0,\"size\":0.01968504}],\"tgs\":\"editText_normal_field\",\"touches\":[{\"tid\":0,\"x\":180,\"y\":372}],\"v\":\"S~C~~0\",\"ts\":1693538003776,\"gyro\":{\"x\":-0.07375981,\"y\":-0.044133715,\"z\":-0.004886778},\"accel\":{\"x\":0.29072794,\"y\":8.943174,\"z\":2.4125633}},{\"type\":\"TOUCH_MOVE\",\"tg\":{\"tgs\":\"editText_normal_field\",\"sender\":\"TextInputEditText\",\"etn\":\"TextInputEditText\"},\"attrs\":[{\"rawAction\":2},{},{\"pointerCount\":1,\"pointers\":{\"0\":{\"mPropId\":0,\"mPropToolType\":1,\"historicalX\":[180,180],\"historicalY\":[372,372]}},\"yValues\":{\"y\":372,\"yP\":1,\"yR\":372,\"yCalc\":372},\"xValues\":{\"x\":180,\"xP\":1,\"xR\":180,\"xCalc\":180},\"pressure\":0.15748031,\"hSize\":2,\"size\":0.027559055}],\"tgs\":\"editText_normal_field\",\"touches\":[{\"tid\":0,\"x\":180,\"y\":372}],\"v\":\"S~C~~0\",\"ts\":1693538003794,\"gyro\":{\"x\":-0.10689827,\"y\":-0.004428643,\"z\":-0.010231691},\"accel\":{\"x\":0.5180461,\"y\":8.472386,\"z\":6.4869423}},{\"type\":\"TOUCH_MOVE\",\"tg\":{\"tgs\":\"editText_normal_field\",\"sender\":\"TextInputEditText\",\"etn\":\"TextInputEditText\"},\"attrs\":[{\"rawAction\":2},{},{\"pointerCount\":1,\"pointers\":{\"0\":{\"mPropId\":0,\"mPropToolType\":1,\"historicalX\":[180],\"historicalY\":[372]}},\"yValues\":{\"y\":372,\"yP\":1,\"yR\":372,\"yCalc\":372},\"xValues\":{\"x\":180,\"xP\":1,\"xR\":180,\"xCalc\":180},\"pressure\":0.15748031,\"hSize\":1,\"size\":0.027559055}],\"tgs\":\"editText_normal_field\",\"touches\":[{\"tid\":0,\"x\":180,\"y\":372}],\"v\":\"S~C~~0\",\"ts\":1693538003810,\"gyro\":{\"x\":0.033138465,\"y\":0.034054734,\"z\":0.00671932},\"accel\":{\"x\":0.26620153,\"y\":8.720044,\"z\":3.6526437}},{\"type\":\"TOUCH_MOVE\",\"tg\":{\"tgs\":\"editText_normal_field\",\"sender\":\"TextInputEditText\",\"etn\":\"TextInputEditText\"},\"attrs\":[{\"rawAction\":2},{},{\"pointerCount\":1,\"pointers\":{\"0\":{\"mPropId\":0,\"mPropToolType\":1,\"historicalX\":[180,180,180],\"historicalY\":[372,372,372]}},\"yValues\":{\"y\":372,\"yP\":1,\"yR\":372,\"yCalc\":372},\"xValues\":{\"x\":180,\"xP\":1,\"xR\":180,\"xCalc\":180},\"pressure\":0.15748031,\"hSize\":3,\"size\":0.027559055}],\"tgs\":\"editText_normal_field\",\"touches\":[{\"tid\":0,\"x\":180,\"y\":372}],\"v\":\"S~C~~0\",\"ts\":1693538003826,\"gyro\":{\"x\":0.03787253,\"y\":0.003970507,\"z\":-0.006566608},\"accel\":{\"x\":0.22492532,\"y\":8.666803,\"z\":4.612764}},{\"type\":\"TOUCH_MOVE\",\"tg\":{\"tgs\":\"editText_normal_field\",\"sender\":\"TextInputEditText\",\"etn\":\"TextInputEditText\"},\"attrs\":[{\"rawAction\":2},{},{\"pointerCount\":1,\"pointers\":{\"0\":{\"mPropId\":0,\"mPropToolType\":1}},\"yValues\":{\"y\":372,\"yP\":1,\"yR\":372,\"yCalc\":372},\"xValues\":{\"x\":180,\"xP\":1,\"xR\":180,\"xCalc\":180},\"pressure\":0.08661418,\"hSize\":0,\"size\":0}],\"tgs\":\"editText_normal_field\",\"touches\":[{\"tid\":0,\"x\":180,\"y\":372}],\"v\":\"S~C~~0\",\"ts\":1693538003830,\"gyro\":{\"x\":0.03787253,\"y\":0.003970507,\"z\":-0.006566608},\"accel\":{\"x\":0.22492532,\"y\":8.666803,\"z\":4.612764}},{\"type\":\"TOUCH_END\",\"tg\":{\"tgs\":\"editText_normal_field\",\"sender\":\"TextInputEditText\",\"etn\":\"TextInputEditText\"},\"attrs\":[{\"rawAction\":1},{},{\"pointerCount\":1,\"pointers\":{\"0\":{\"mPropId\":0,\"mPropToolType\":1}},\"yValues\":{\"y\":372,\"yP\":1,\"yR\":372,\"yCalc\":372},\"xValues\":{\"x\":180,\"xP\":1,\"xR\":180,\"xCalc\":180},\"pressure\":0.08661418,\"hSize\":0,\"size\":0}],\"tgs\":\"editText_normal_field\",\"touches\":[{\"tid\":0,\"x\":180,\"y\":372}],\"v\":\"S~C~~0\",\"ts\":1693538003832,\"gyro\":{\"x\":0.03787253,\"y\":0.003970507,\"z\":-0.006566608},\"accel\":{\"x\":0.22492532,\"y\":8.666803,\"z\":4.612764}},{\"type\":\"FOCUS\",\"tg\":{\"attr\":[{\"n\":\"v\",\"v\":\"S~C~~0\"},{\"n\":\"hash\",\"v\":\"31b2646f\"}]},\"tgs\":\"editText_normal_field\",\"ts\":1693538003834,\"gyro\":{\"x\":0.03787253,\"y\":0.003970507,\"z\":-0.006566608},\"accel\":{\"x\":0.22492532,\"y\":8.666803,\"z\":4.612764}},{\"type\":\"REGISTER_TARGET\",\"tg\":{\"attr\":[{\"n\":\"guid\",\"v\":\"67d50f9d-c5e5-328d-906f-e2e8cb2fce0d\"},{\"n\":\"screenHierarchy\",\"v\":\"FrameLayout/TextInputLayout/LinearLayout/AppInit\"},{\"parentClass\":\"\",\"component\":\"\"},{}]},\"attrs\":[{\"n\":\"guid\",\"v\":\"67d50f9d-c5e5-328d-906f-e2e8cb2fce0d\"},{\"n\":\"screenHierarchy\",\"v\":\"FrameLayout/TextInputLayout/LinearLayout/AppInit\"},{\"parentClass\":\"\",\"component\":\"\"},{}],\"tgs\":\"editText_normal_field\",\"v\":\"S~C~~0\",\"hv\":\"1b76f744\",\"en\":\"editText_normal_field\",\"etn\":\"INPUT\",\"ec\":\"AppInit\",\"et\":\"Edittext::TextInputEditText\",\"eid\":\"editText_normal_field\",\"ts\":1693538003836,\"rts\":\"targetInteractionEvent\",\"url\":\"android://com.sample.neuroid.us.activities.NIDSomeFragmentsActivity/editText_normal_field\",\"gyro\":{\"x\":0.03787253,\"y\":0.003970507,\"z\":-0.006566608},\"accel\":{\"x\":0.22492532,\"y\":8.666803,\"z\":4.612764}},{\"type\":\"WINDOW_RESIZE\",\"ts\":1693538003945,\"w\":1080,\"h\":1891,\"gyro\":{\"x\":-0.004123219,\"y\":0.016492875,\"z\":0.0019852535},\"accel\":{\"x\":-0.26679972,\"y\":8.881559,\"z\":4.1425743}},{\"type\":\"WINDOW_RESIZE\",\"ts\":1693538004161,\"w\":1080,\"h\":1074,\"gyro\":{\"x\":0.011911522,\"y\":0.00671932,\"z\":-4.5813544E-4},\"accel\":{\"x\":0.18604197,\"y\":9.002397,\"z\":4.118646}},{\"type\":\"INPUT\",\"tg\":{\"attr\":[{\"n\":\"v\",\"v\":\"S~C~~1\"},{\"n\":\"hash\",\"v\":\"8bb9337f\"}],\"etn\":\"INPUT\",\"et\":\"text\"},\"tgs\":\"editText_normal_field\",\"v\":\"S~C~~1\",\"hv\":\"8bb9337f\",\"ts\":1693538006695,\"gyro\":{\"x\":-0.00167983,\"y\":-0.006413896,\"z\":0.0021379655},\"accel\":{\"x\":0.18125631,\"y\":8.98804,\"z\":4.0755754}}]}"
        val eventSender = NIDEventSender(apiService)
        eventSender.sendTrackerData(events, "test", callback)
        verify {
            callback.onSuccess(200)
        }
    }

    @Test
    fun `failed send request 3 times test`() = runBlocking {
        val apiService = mockk<NIDApiService>()
        val call = mockk<Call<ResponseBody>>()
        val retryClone = mockk<Call<ResponseBody>>()
        val response = mockk<Response<ResponseBody>>()
        val responseBody = mockk<ResponseBody>()
        every {responseBody.close()} just Runs
        every {response.isSuccessful} returns false
        every {response.code()} returns 400
        every {response.message()} returns "your request is junk, fix it!"
        every {response.body()} returns responseBody
        every {retryClone.execute()} returns response
        every {call.clone()} returns retryClone
        every {apiService.sendEvents(any(), any())} returns call
        val callback = mockk<NIDResponseCallBack>()
        every { callback.onSuccess(any()) } just Runs
        every { callback.onFailure(any(), any(), any()) } just Runs
        val events = "{\"siteId\":\"guns_452\",\"userId\":\"1693537992533\",\"clientId\":\"1-1-1-1\",\"identityId\":\"1693537992533\",\"pageTag\":\"com.sample.neuroid.us.activities.NIDSomeFragmentsActivity\",\"pageId\":\"mobile\",\"tabId\":\"mobile\",\"responseId\":\"bf57ea3b5402\",\"url\":\"android://com.sample.neuroid.us.activities.NIDSomeFragmentsActivity\",\"jsVersion\":\"5.0.0\",\"sdkVersion\":\"5.android-3.0.1\",\"environment\":\"LIVE\",\"jsonEvents\":[{\"type\":\"TOUCH_START\",\"tg\":{\"tgs\":\"editText_normal_field\",\"sender\":\"TextInputEditText\",\"etn\":\"TextInputEditText\"},\"attrs\":[{\"rawAction\":0},{},{\"pointerCount\":1,\"pointers\":{\"0\":{\"mPropId\":0,\"mPropToolType\":1}},\"yValues\":{\"y\":372,\"yP\":1,\"yR\":372,\"yCalc\":372},\"xValues\":{\"x\":180,\"xP\":1,\"xR\":180,\"xCalc\":180},\"pressure\":0.13385826,\"hSize\":0,\"size\":0.01968504}],\"tgs\":\"editText_normal_field\",\"touches\":[{\"tid\":0,\"x\":180,\"y\":372}],\"v\":\"S~C~~0\",\"ts\":1693538003776,\"gyro\":{\"x\":-0.07375981,\"y\":-0.044133715,\"z\":-0.004886778},\"accel\":{\"x\":0.29072794,\"y\":8.943174,\"z\":2.4125633}},{\"type\":\"TOUCH_MOVE\",\"tg\":{\"tgs\":\"editText_normal_field\",\"sender\":\"TextInputEditText\",\"etn\":\"TextInputEditText\"},\"attrs\":[{\"rawAction\":2},{},{\"pointerCount\":1,\"pointers\":{\"0\":{\"mPropId\":0,\"mPropToolType\":1,\"historicalX\":[180,180],\"historicalY\":[372,372]}},\"yValues\":{\"y\":372,\"yP\":1,\"yR\":372,\"yCalc\":372},\"xValues\":{\"x\":180,\"xP\":1,\"xR\":180,\"xCalc\":180},\"pressure\":0.15748031,\"hSize\":2,\"size\":0.027559055}],\"tgs\":\"editText_normal_field\",\"touches\":[{\"tid\":0,\"x\":180,\"y\":372}],\"v\":\"S~C~~0\",\"ts\":1693538003794,\"gyro\":{\"x\":-0.10689827,\"y\":-0.004428643,\"z\":-0.010231691},\"accel\":{\"x\":0.5180461,\"y\":8.472386,\"z\":6.4869423}},{\"type\":\"TOUCH_MOVE\",\"tg\":{\"tgs\":\"editText_normal_field\",\"sender\":\"TextInputEditText\",\"etn\":\"TextInputEditText\"},\"attrs\":[{\"rawAction\":2},{},{\"pointerCount\":1,\"pointers\":{\"0\":{\"mPropId\":0,\"mPropToolType\":1,\"historicalX\":[180],\"historicalY\":[372]}},\"yValues\":{\"y\":372,\"yP\":1,\"yR\":372,\"yCalc\":372},\"xValues\":{\"x\":180,\"xP\":1,\"xR\":180,\"xCalc\":180},\"pressure\":0.15748031,\"hSize\":1,\"size\":0.027559055}],\"tgs\":\"editText_normal_field\",\"touches\":[{\"tid\":0,\"x\":180,\"y\":372}],\"v\":\"S~C~~0\",\"ts\":1693538003810,\"gyro\":{\"x\":0.033138465,\"y\":0.034054734,\"z\":0.00671932},\"accel\":{\"x\":0.26620153,\"y\":8.720044,\"z\":3.6526437}},{\"type\":\"TOUCH_MOVE\",\"tg\":{\"tgs\":\"editText_normal_field\",\"sender\":\"TextInputEditText\",\"etn\":\"TextInputEditText\"},\"attrs\":[{\"rawAction\":2},{},{\"pointerCount\":1,\"pointers\":{\"0\":{\"mPropId\":0,\"mPropToolType\":1,\"historicalX\":[180,180,180],\"historicalY\":[372,372,372]}},\"yValues\":{\"y\":372,\"yP\":1,\"yR\":372,\"yCalc\":372},\"xValues\":{\"x\":180,\"xP\":1,\"xR\":180,\"xCalc\":180},\"pressure\":0.15748031,\"hSize\":3,\"size\":0.027559055}],\"tgs\":\"editText_normal_field\",\"touches\":[{\"tid\":0,\"x\":180,\"y\":372}],\"v\":\"S~C~~0\",\"ts\":1693538003826,\"gyro\":{\"x\":0.03787253,\"y\":0.003970507,\"z\":-0.006566608},\"accel\":{\"x\":0.22492532,\"y\":8.666803,\"z\":4.612764}},{\"type\":\"TOUCH_MOVE\",\"tg\":{\"tgs\":\"editText_normal_field\",\"sender\":\"TextInputEditText\",\"etn\":\"TextInputEditText\"},\"attrs\":[{\"rawAction\":2},{},{\"pointerCount\":1,\"pointers\":{\"0\":{\"mPropId\":0,\"mPropToolType\":1}},\"yValues\":{\"y\":372,\"yP\":1,\"yR\":372,\"yCalc\":372},\"xValues\":{\"x\":180,\"xP\":1,\"xR\":180,\"xCalc\":180},\"pressure\":0.08661418,\"hSize\":0,\"size\":0}],\"tgs\":\"editText_normal_field\",\"touches\":[{\"tid\":0,\"x\":180,\"y\":372}],\"v\":\"S~C~~0\",\"ts\":1693538003830,\"gyro\":{\"x\":0.03787253,\"y\":0.003970507,\"z\":-0.006566608},\"accel\":{\"x\":0.22492532,\"y\":8.666803,\"z\":4.612764}},{\"type\":\"TOUCH_END\",\"tg\":{\"tgs\":\"editText_normal_field\",\"sender\":\"TextInputEditText\",\"etn\":\"TextInputEditText\"},\"attrs\":[{\"rawAction\":1},{},{\"pointerCount\":1,\"pointers\":{\"0\":{\"mPropId\":0,\"mPropToolType\":1}},\"yValues\":{\"y\":372,\"yP\":1,\"yR\":372,\"yCalc\":372},\"xValues\":{\"x\":180,\"xP\":1,\"xR\":180,\"xCalc\":180},\"pressure\":0.08661418,\"hSize\":0,\"size\":0}],\"tgs\":\"editText_normal_field\",\"touches\":[{\"tid\":0,\"x\":180,\"y\":372}],\"v\":\"S~C~~0\",\"ts\":1693538003832,\"gyro\":{\"x\":0.03787253,\"y\":0.003970507,\"z\":-0.006566608},\"accel\":{\"x\":0.22492532,\"y\":8.666803,\"z\":4.612764}},{\"type\":\"FOCUS\",\"tg\":{\"attr\":[{\"n\":\"v\",\"v\":\"S~C~~0\"},{\"n\":\"hash\",\"v\":\"31b2646f\"}]},\"tgs\":\"editText_normal_field\",\"ts\":1693538003834,\"gyro\":{\"x\":0.03787253,\"y\":0.003970507,\"z\":-0.006566608},\"accel\":{\"x\":0.22492532,\"y\":8.666803,\"z\":4.612764}},{\"type\":\"REGISTER_TARGET\",\"tg\":{\"attr\":[{\"n\":\"guid\",\"v\":\"67d50f9d-c5e5-328d-906f-e2e8cb2fce0d\"},{\"n\":\"screenHierarchy\",\"v\":\"FrameLayout/TextInputLayout/LinearLayout/AppInit\"},{\"parentClass\":\"\",\"component\":\"\"},{}]},\"attrs\":[{\"n\":\"guid\",\"v\":\"67d50f9d-c5e5-328d-906f-e2e8cb2fce0d\"},{\"n\":\"screenHierarchy\",\"v\":\"FrameLayout/TextInputLayout/LinearLayout/AppInit\"},{\"parentClass\":\"\",\"component\":\"\"},{}],\"tgs\":\"editText_normal_field\",\"v\":\"S~C~~0\",\"hv\":\"1b76f744\",\"en\":\"editText_normal_field\",\"etn\":\"INPUT\",\"ec\":\"AppInit\",\"et\":\"Edittext::TextInputEditText\",\"eid\":\"editText_normal_field\",\"ts\":1693538003836,\"rts\":\"targetInteractionEvent\",\"url\":\"android://com.sample.neuroid.us.activities.NIDSomeFragmentsActivity/editText_normal_field\",\"gyro\":{\"x\":0.03787253,\"y\":0.003970507,\"z\":-0.006566608},\"accel\":{\"x\":0.22492532,\"y\":8.666803,\"z\":4.612764}},{\"type\":\"WINDOW_RESIZE\",\"ts\":1693538003945,\"w\":1080,\"h\":1891,\"gyro\":{\"x\":-0.004123219,\"y\":0.016492875,\"z\":0.0019852535},\"accel\":{\"x\":-0.26679972,\"y\":8.881559,\"z\":4.1425743}},{\"type\":\"WINDOW_RESIZE\",\"ts\":1693538004161,\"w\":1080,\"h\":1074,\"gyro\":{\"x\":0.011911522,\"y\":0.00671932,\"z\":-4.5813544E-4},\"accel\":{\"x\":0.18604197,\"y\":9.002397,\"z\":4.118646}},{\"type\":\"INPUT\",\"tg\":{\"attr\":[{\"n\":\"v\",\"v\":\"S~C~~1\"},{\"n\":\"hash\",\"v\":\"8bb9337f\"}],\"etn\":\"INPUT\",\"et\":\"text\"},\"tgs\":\"editText_normal_field\",\"v\":\"S~C~~1\",\"hv\":\"8bb9337f\",\"ts\":1693538006695,\"gyro\":{\"x\":-0.00167983,\"y\":-0.006413896,\"z\":0.0021379655},\"accel\":{\"x\":0.18125631,\"y\":8.98804,\"z\":4.0755754}}]}"
        val eventSender = NIDEventSender(apiService)
        eventSender.sendTrackerData(events, "test", callback)
        verify(exactly = 3) {
            callback.onFailure(400, "your request is junk, fix it!", any())
        }
    }

    @Test
    fun `failed exception send request test`() = runBlocking {
        val apiService = mockk<NIDApiService>()
        val call = mockk<Call<ResponseBody>>()
        val retryClone = mockk<Call<ResponseBody>>()
        val response = mockk<Response<ResponseBody>>()
        every {response.isSuccessful} returns false
        every {response.code()} returns 400
        every {response.message()} returns "your request is junk, fix it!"
        every {retryClone.execute()} throws Exception("we blew it, sorry")
        every {call.clone()} returns retryClone
        every {apiService.sendEvents(any(), any())} returns call
        val callback = mockk<NIDResponseCallBack>()
        every { callback.onSuccess(any()) } just Runs
        every { callback.onFailure(any(), any(), any()) } just Runs
        val events = "{\"siteId\":\"death_122\",\"userId\":\"1693537992533\",\"clientId\":\"1-1-1-1\",\"identityId\":\"1693537992533\",\"pageTag\":\"com.sample.neuroid.us.activities.NIDSomeFragmentsActivity\",\"pageId\":\"mobile\",\"tabId\":\"mobile\",\"responseId\":\"bf57ea3b5402\",\"url\":\"android://com.sample.neuroid.us.activities.NIDSomeFragmentsActivity\",\"jsVersion\":\"5.0.0\",\"sdkVersion\":\"5.android-3.0.1\",\"environment\":\"LIVE\",\"jsonEvents\":[{\"type\":\"TOUCH_START\",\"tg\":{\"tgs\":\"editText_normal_field\",\"sender\":\"TextInputEditText\",\"etn\":\"TextInputEditText\"},\"attrs\":[{\"rawAction\":0},{},{\"pointerCount\":1,\"pointers\":{\"0\":{\"mPropId\":0,\"mPropToolType\":1}},\"yValues\":{\"y\":372,\"yP\":1,\"yR\":372,\"yCalc\":372},\"xValues\":{\"x\":180,\"xP\":1,\"xR\":180,\"xCalc\":180},\"pressure\":0.13385826,\"hSize\":0,\"size\":0.01968504}],\"tgs\":\"editText_normal_field\",\"touches\":[{\"tid\":0,\"x\":180,\"y\":372}],\"v\":\"S~C~~0\",\"ts\":1693538003776,\"gyro\":{\"x\":-0.07375981,\"y\":-0.044133715,\"z\":-0.004886778},\"accel\":{\"x\":0.29072794,\"y\":8.943174,\"z\":2.4125633}},{\"type\":\"TOUCH_MOVE\",\"tg\":{\"tgs\":\"editText_normal_field\",\"sender\":\"TextInputEditText\",\"etn\":\"TextInputEditText\"},\"attrs\":[{\"rawAction\":2},{},{\"pointerCount\":1,\"pointers\":{\"0\":{\"mPropId\":0,\"mPropToolType\":1,\"historicalX\":[180,180],\"historicalY\":[372,372]}},\"yValues\":{\"y\":372,\"yP\":1,\"yR\":372,\"yCalc\":372},\"xValues\":{\"x\":180,\"xP\":1,\"xR\":180,\"xCalc\":180},\"pressure\":0.15748031,\"hSize\":2,\"size\":0.027559055}],\"tgs\":\"editText_normal_field\",\"touches\":[{\"tid\":0,\"x\":180,\"y\":372}],\"v\":\"S~C~~0\",\"ts\":1693538003794,\"gyro\":{\"x\":-0.10689827,\"y\":-0.004428643,\"z\":-0.010231691},\"accel\":{\"x\":0.5180461,\"y\":8.472386,\"z\":6.4869423}},{\"type\":\"TOUCH_MOVE\",\"tg\":{\"tgs\":\"editText_normal_field\",\"sender\":\"TextInputEditText\",\"etn\":\"TextInputEditText\"},\"attrs\":[{\"rawAction\":2},{},{\"pointerCount\":1,\"pointers\":{\"0\":{\"mPropId\":0,\"mPropToolType\":1,\"historicalX\":[180],\"historicalY\":[372]}},\"yValues\":{\"y\":372,\"yP\":1,\"yR\":372,\"yCalc\":372},\"xValues\":{\"x\":180,\"xP\":1,\"xR\":180,\"xCalc\":180},\"pressure\":0.15748031,\"hSize\":1,\"size\":0.027559055}],\"tgs\":\"editText_normal_field\",\"touches\":[{\"tid\":0,\"x\":180,\"y\":372}],\"v\":\"S~C~~0\",\"ts\":1693538003810,\"gyro\":{\"x\":0.033138465,\"y\":0.034054734,\"z\":0.00671932},\"accel\":{\"x\":0.26620153,\"y\":8.720044,\"z\":3.6526437}},{\"type\":\"TOUCH_MOVE\",\"tg\":{\"tgs\":\"editText_normal_field\",\"sender\":\"TextInputEditText\",\"etn\":\"TextInputEditText\"},\"attrs\":[{\"rawAction\":2},{},{\"pointerCount\":1,\"pointers\":{\"0\":{\"mPropId\":0,\"mPropToolType\":1,\"historicalX\":[180,180,180],\"historicalY\":[372,372,372]}},\"yValues\":{\"y\":372,\"yP\":1,\"yR\":372,\"yCalc\":372},\"xValues\":{\"x\":180,\"xP\":1,\"xR\":180,\"xCalc\":180},\"pressure\":0.15748031,\"hSize\":3,\"size\":0.027559055}],\"tgs\":\"editText_normal_field\",\"touches\":[{\"tid\":0,\"x\":180,\"y\":372}],\"v\":\"S~C~~0\",\"ts\":1693538003826,\"gyro\":{\"x\":0.03787253,\"y\":0.003970507,\"z\":-0.006566608},\"accel\":{\"x\":0.22492532,\"y\":8.666803,\"z\":4.612764}},{\"type\":\"TOUCH_MOVE\",\"tg\":{\"tgs\":\"editText_normal_field\",\"sender\":\"TextInputEditText\",\"etn\":\"TextInputEditText\"},\"attrs\":[{\"rawAction\":2},{},{\"pointerCount\":1,\"pointers\":{\"0\":{\"mPropId\":0,\"mPropToolType\":1}},\"yValues\":{\"y\":372,\"yP\":1,\"yR\":372,\"yCalc\":372},\"xValues\":{\"x\":180,\"xP\":1,\"xR\":180,\"xCalc\":180},\"pressure\":0.08661418,\"hSize\":0,\"size\":0}],\"tgs\":\"editText_normal_field\",\"touches\":[{\"tid\":0,\"x\":180,\"y\":372}],\"v\":\"S~C~~0\",\"ts\":1693538003830,\"gyro\":{\"x\":0.03787253,\"y\":0.003970507,\"z\":-0.006566608},\"accel\":{\"x\":0.22492532,\"y\":8.666803,\"z\":4.612764}},{\"type\":\"TOUCH_END\",\"tg\":{\"tgs\":\"editText_normal_field\",\"sender\":\"TextInputEditText\",\"etn\":\"TextInputEditText\"},\"attrs\":[{\"rawAction\":1},{},{\"pointerCount\":1,\"pointers\":{\"0\":{\"mPropId\":0,\"mPropToolType\":1}},\"yValues\":{\"y\":372,\"yP\":1,\"yR\":372,\"yCalc\":372},\"xValues\":{\"x\":180,\"xP\":1,\"xR\":180,\"xCalc\":180},\"pressure\":0.08661418,\"hSize\":0,\"size\":0}],\"tgs\":\"editText_normal_field\",\"touches\":[{\"tid\":0,\"x\":180,\"y\":372}],\"v\":\"S~C~~0\",\"ts\":1693538003832,\"gyro\":{\"x\":0.03787253,\"y\":0.003970507,\"z\":-0.006566608},\"accel\":{\"x\":0.22492532,\"y\":8.666803,\"z\":4.612764}},{\"type\":\"FOCUS\",\"tg\":{\"attr\":[{\"n\":\"v\",\"v\":\"S~C~~0\"},{\"n\":\"hash\",\"v\":\"31b2646f\"}]},\"tgs\":\"editText_normal_field\",\"ts\":1693538003834,\"gyro\":{\"x\":0.03787253,\"y\":0.003970507,\"z\":-0.006566608},\"accel\":{\"x\":0.22492532,\"y\":8.666803,\"z\":4.612764}},{\"type\":\"REGISTER_TARGET\",\"tg\":{\"attr\":[{\"n\":\"guid\",\"v\":\"67d50f9d-c5e5-328d-906f-e2e8cb2fce0d\"},{\"n\":\"screenHierarchy\",\"v\":\"FrameLayout/TextInputLayout/LinearLayout/AppInit\"},{\"parentClass\":\"\",\"component\":\"\"},{}]},\"attrs\":[{\"n\":\"guid\",\"v\":\"67d50f9d-c5e5-328d-906f-e2e8cb2fce0d\"},{\"n\":\"screenHierarchy\",\"v\":\"FrameLayout/TextInputLayout/LinearLayout/AppInit\"},{\"parentClass\":\"\",\"component\":\"\"},{}],\"tgs\":\"editText_normal_field\",\"v\":\"S~C~~0\",\"hv\":\"1b76f744\",\"en\":\"editText_normal_field\",\"etn\":\"INPUT\",\"ec\":\"AppInit\",\"et\":\"Edittext::TextInputEditText\",\"eid\":\"editText_normal_field\",\"ts\":1693538003836,\"rts\":\"targetInteractionEvent\",\"url\":\"android://com.sample.neuroid.us.activities.NIDSomeFragmentsActivity/editText_normal_field\",\"gyro\":{\"x\":0.03787253,\"y\":0.003970507,\"z\":-0.006566608},\"accel\":{\"x\":0.22492532,\"y\":8.666803,\"z\":4.612764}},{\"type\":\"WINDOW_RESIZE\",\"ts\":1693538003945,\"w\":1080,\"h\":1891,\"gyro\":{\"x\":-0.004123219,\"y\":0.016492875,\"z\":0.0019852535},\"accel\":{\"x\":-0.26679972,\"y\":8.881559,\"z\":4.1425743}},{\"type\":\"WINDOW_RESIZE\",\"ts\":1693538004161,\"w\":1080,\"h\":1074,\"gyro\":{\"x\":0.011911522,\"y\":0.00671932,\"z\":-4.5813544E-4},\"accel\":{\"x\":0.18604197,\"y\":9.002397,\"z\":4.118646}},{\"type\":\"INPUT\",\"tg\":{\"attr\":[{\"n\":\"v\",\"v\":\"S~C~~1\"},{\"n\":\"hash\",\"v\":\"8bb9337f\"}],\"etn\":\"INPUT\",\"et\":\"text\"},\"tgs\":\"editText_normal_field\",\"v\":\"S~C~~1\",\"hv\":\"8bb9337f\",\"ts\":1693538006695,\"gyro\":{\"x\":-0.00167983,\"y\":-0.006413896,\"z\":0.0021379655},\"accel\":{\"x\":0.18125631,\"y\":8.98804,\"z\":4.0755754}}]}"
        val eventSender = NIDEventSender(apiService)
        eventSender.sendTrackerData(events, "test", callback)
        verify {
            callback.onFailure(-1, "we blew it, sorry", any())
        }
    }

}